<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/index.js - archetypo</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="archetypo"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/archetypo.html">archetypo</a></li>
            
                <li><a href="../modules/view.html">view</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

/**
 * AMD module.
 *
 * @module archetypo
 */

define(function (require, exports, module) {
	&#x27;use strict&#x27;;

	var _ = require(&#x27;lodash&#x27;),
		$ = require(&#x27;jquery&#x27;),
		subject = require(&#x27;subject&#x27;),
		q = require(&#x27;q&#x27;);

	// internal
	var build = require(&#x27;./__archetypo/build/index&#x27;),
		scopeManager = require(&#x27;./__archetypo/scope-manager&#x27;);

	/**
	 * The archetypo object
	 *
	 *
	 */
	var archetypo = module.exports = subject({

		prefix: &#x27;arch&#x27;,


		availableMethods: [],

		methods: {

			require: function archRequire(modulePath, done) {

				console.log(&#x27;required &#x27; + modulePath);

				require([modulePath], function (module) {
					done(module);
				});
			}
		},

		/**
		 *
		 *
		 * Hash to hold all functions.
		 *
		 */
		fns: {

		},


		/**
		 * This method evaluates the value string
		 * It is called upon any value string.
		 *
		 * The default version returns the jq-object if value === &#x27;this&#x27;
		 *
		 * @method evaluator
		 * @param value
		 */
		evaluator: function evaluate(value) {
			if (value === &#x27;this&#x27;) {
				return this;
			} else {
				return value;
			}
		},

		/**
		 * Hash holding processors to be called for evaluation
		 *
		 * Processors are &#x27;argument-length-aware&#x27; functions.
		 * If the processor function takes ...
		 *     1 argument : [value]       (synchronous)
		 *     2 arguments: [value, done] (asynchronous)
		 *
		 * @property processors
		 * @type Object
		 */
		processors: {
			require: function archRequire(modulePath, done) {

				console.log(&#x27;required &#x27; + modulePath);

				require([modulePath], function (module) {
					done(module);
				});
			}
		},

		/**
		 * Hash holding the default processors for each archProperty.
		 *
		 * @property defaultProcessors
		 * @type Object
		 */
		defaultProcessors: {
			fn: &#x27;require&#x27;,
		},

		/**
		 * Hash holding the default properties
		 * and their values (pre-evaluated and pre-processed)
		 *
		 * @property defaultProperties
		 * @type Object
		 */
		defaultProperties: {
			el: {
				processor: void(0),
				value: &#x27;this&#x27;,
			},
		},

		/**
		 *
		 * @param el {jq-object}
		 * @param options
		 *     @param processors {Object}
		 *     @param defaultProcessors {Object}
		 */
		initialize: function initializeArchetypo(el, options) {

			options = options || {};

			// [0] el reference.
			// [0.1] save the archetypo object to the el
			el.data(&#x27;archetypo&#x27;, this);
			// [0.2] save reference to the el on archetypo object
			//////////////////////////////////////////////////////////////
			// OBS:  YES, circular reference... will this bring issues? //
			//////////////////////////////////////////////////////////////
			this.el = el;


			// [1] ancestor chain
			// [1.1] get closest ancestor that has data-archetypo
			var ancestorArchetypoEl = el.parent().closest(&#x27;[data-archetypo]&#x27;);

			// [1.2] get the archetypo object from ancestor and keep reference to it.
			/**
			 * Reference to the nearest archetypo ascendant.
			 *
			 * @property parent
			 * @type archetypo-object
			 */
			this.parent = ancestorArchetypoEl.data(&#x27;archetypo&#x27;);


			// [2] extend some options
			// [2.1] extensions
			_.each(
				_.pick(options, [&#x27;processors&#x27;, &#x27;defaultProcessors&#x27;]),
				function (extensions, key) {
					_.extend(this[key], extensions);
				}, this);

			// [2.2] direct values
			this.evaluator = options.evaluator || this.evaluator;


			// [3] build a namespace manager
			this.scope = scopeManager({
				// parent refers not to the archetypo object parent
				// but to the scope manager of the parent
				parent: this.parent ? this.parent.scope : false
			});

			// [4] invoke build
			/**
			 * Promise to be resolved only when the view is ready.
			 *
			 * @property promise
			 * @type q-promise-object
			 */
			this.promise = build.call(this);

		},

		/**
		 * Retrieves a namespace object.
		 *
		 * @method namespace
		 * @param slug {String}
		 */
		namespace: function getNamespace(slug) {
			return this.namespaces[slug];
		},
	});




	// PLUGIN AREA //


	/**
	 * Retrieves a single archetypo from the $el.
	 *
	 * @method getArchetypo
	 * @private
	 */
	function getArchetypo($el, name) {

		name = name || &#x27;main&#x27;;

		// direct view
		return $el.data(storage)[name];
	}

	/**
	 * Invokes the archetypo builder on the element
	 *
	 * @method buildArchetypo
	 * @private
	 */
	function buildArchetypo($el, options) {
		options = options || {};

		// set default options
		_.defaults(options, defaultOptions);

		// if the storage option is set,
		// reset the storage string
		storage = options.storage = options.storage || storage;

		// build up
		return buildEl($el, options);
	}


	$.prototype.archetypo = function archetypo() {

		var initialized = this.data(&#x27;__archetypo-initialized&#x27;);

		if (initialized &amp;&amp; (arguments.length === 0 || _.isString(arguments[0]))) {
			// get the main archetypo
			return getArchetypo(this, arguments[0]);

		} else {

			// set archetypo as initialized
			this.data(&#x27;__archetypo-initialized&#x27;, true);

			return buildArchetypo(this, arguments[0]);
		}
	};

});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
