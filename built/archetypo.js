//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define("__archetypo/build-sub",["require","exports","module","lodash","jquery","q"],function(e,r,t){var a=e("lodash"),n=e("jquery"),o=e("q");t.exports=function(e,r){var t=e.find("[data-archetypo]"),u=a.map(t,function(e){return n(e).archetypo(r)},this);return o.all(u)}}),define("__archetypo/load",["require","exports","module","lodash","q"],function(e,r,t){var a=e("lodash"),n=e("q");t.exports=function(r){var t=n.defer(),o=a.keys(r),u=a.values(r);return e(u,function(){t.resolve(a.zipObject(o,arguments))}),t.promise}}),define("__archetypo/parse-prefixed-data",["require","exports","module","lodash"],function(e,r,t){var a=e("lodash");t.exports=function(e,r){r=a.isString(r)?new RegExp("^"+r):r;var t=e.data(),n={};return a.each(t,function(e,t){if(r.test(t)){var a=t.replace(r,"");a=a.charAt(0).toLowerCase()+a.slice(1),n[a]=e}}),n}}),define("__archetypo/build-el",["require","exports","module","lodash","jquery","q","./build-sub","./load","./parse-prefixed-data"],function(e,r,t){var a=e("lodash"),n=(e("jquery"),e("q")),o=e("./build-sub"),u=e("./load"),i=e("./parse-prefixed-data");t.exports=function(e,r){var t=e.data("_arch-promise");if(!t){e.data(r.storage,{});var s=i(e,r.modulePrefix),d=i(e,r.viewPrefix),l=[u(d),u(s)];t=n.spread(l,function(t,o){var u=a.extend({el:e},r,o),i=a.map(t,function(t,a){return n.when(t(u)).then(function(t){e.data(r.storage)[a]=t})});return n.all(i)}).then(function(){return o(e,r)}).then(function(){return e}),e.data("_arch-promise",t),t.done()}return t}}),define("archetypo",["require","exports","module","lodash","jquery","./__archetypo/build-el"],function(e){var r=e("lodash"),t=e("jquery"),a=e("./__archetypo/build-el"),n={modulePrefix:/^module/,viewPrefix:/^view/},o="_arch-views";t.prototype.archetypo=function(){if(r.isString(arguments[0])){if(1===arguments.length)return this.data(o)[arguments[0]];var e=this.find(arguments[0]);return r.map(e,function(e){return t(e).archetypo(arguments[1])})}var u=arguments[0]||{};return r.defaults(u,n),o=u.storage=u.storage||o,a(this,u)}});