//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define("__archetypo/build-sub",["require","exports","module","lodash","jquery","q"],function(e,r,t){var n=e("lodash"),u=e("jquery"),o=e("q");t.exports=function(e,r){var t=e.find("[data-builder]"),i=n.map(t,function(e){u(e).archetypo(r)},this);return o.all(i)}}),define("__archetypo/load",["require","exports","module","lodash","q"],function(e,r){function t(r,t){var n=o.defer();return e(t,function(){n.resolve(u.zipObject(r,arguments))}),n.promise}function n(e){return u.isString(e)?e.split(i):[]}var u=e("lodash"),o=e("q");r.modules=function(e,r){var n=e.data(),o=[],i=[];return u.each(r,function(e){var r=n[e];u.isString(r)&&(o.push(e),i.push(r))}),t(o,i)};var i=/\s+/;r.builders=function(e){var r=n(e.data("builder")),o=[],i=[];return u.each(r,function(e){var r=e.split(":");2===r.length?(o.push(r[0]),i.push(r[1])):(o.push(e),i.push(e))}),t(o,i)}}),define("__archetypo/build-el",["require","exports","module","lodash","jquery","q","./build-sub","./load"],function(e,r,t){var n=e("lodash"),u=(e("jquery"),e("q")),o=e("./build-sub"),i=e("./load");t.exports=function(e,r){var t=e.data("archetypo-promise");if(!t){e.data("views",{});var a=[i.builders(e),i.modules(e,r.loadable)];t=u.spread(a,function(t,o){var i=n.extend({el:e},r,o),a=n.map(t,function(r,t){return u.when(r(i)).then(function(r){e.data("views")[t]=r})});return u.all(a)}).then(function(){return o(e,r)}).then(function(){return e}),e.data("archetypo-promise",t),t.done()}return t}}),define("archetypo",["require","exports","module","lodash","jquery","./__archetypo/build-el"],function(e){var r=e("lodash"),t=e("jquery"),n=e("./__archetypo/build-el");t.prototype.archetypo=function(e){return n(this,e)},t.prototype.view=function(e){return this.data("views")[e]},t.prototype.subviews=function(e,n){var u=this.find(e);return r(u).map(function(e){return t(e).view(n)})}});