//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define("__archetypo/router/format",["require","exports","module","lodash"],function(e,t,r){function i(e){return e.replace(/(\(|\(.*:|:|\)|\*)/,"")}var o=(e("lodash"),/\((.*?)\)/g),n=/(\(\?)?:\w+/g,a=/\*\w+/g;r.exports=function(e,t){return e=e.replace(n,function(e){var r=i(e);return t[r]?t[r]:e}),e=e.replace(a,function(e){var r=i(e);return t[r]?t[r]:""}),e.replace(o,"")}}),define("__archetypo/router/index",["require","exports","module","lodash","lowercase-backbone","./format"],function(e,t,r){{var i=e("lodash"),o=e("lowercase-backbone").router,n=e("./format");r.exports=o.extend({initialize:function(){this.initializeArchRouter.apply(this,arguments)},initializeArchRouter:function(){this.routeFormats={}},route:function(e,t){return i.isString(t)&&(this.routeFormats[t]=e),o.prototype.route.apply(this,arguments)},navigate:function(e,t,r){var i=this.routeFormats[e];if(i){var a=n(i,t);return o.prototype.navigate.call(this,a,r)}return o.prototype.navigate.apply(this,arguments)}})}}),define("__archetypo/builder",["require","exports","module","q"],function(e,t){var r=e("q");t.builder=function(e,t){return 1===arguments.length?this.getBuilder(e):2===arguments.length?this.defineBuilder(e,t):void 0},t.defineBuilder=function(e,t){return this.builders[e]=t,this},t.getBuilder=function(t){var i=r.deferred(),o=this.builders[t];return o?i.resolve(o):e([t],i.resolve),i.promise}}),define("archetypo",["require","exports","module","lowercase-backbone","lodash","jquery","archetypo-view","./__archetypo/router/index","./__archetypo/builder"],function(e,t,r){var i=e("lowercase-backbone"),o=(e("lodash"),e("jquery")),n=e("archetypo-view"),a=e("./__archetypo/router/index"),u=r.exports=n.extend(i.router.prototype).extend(a.prototype);u.proto({initialize:function(){this.initializeArchetypo.apply(this,arguments)},initializeArchetypo:function(e){this.initializeArchRouter(e),this.builders={"default":n}},start:function(e){return e=e||{},e.app=this,e.el=e.el||o("[data-archetypo],[archetypo]"),i.view.prototype.initialize.apply(this,arguments),this.initializeArchetypoView(e),i.history.start(e),this}}),u.proto(e("./__archetypo/builder"))});