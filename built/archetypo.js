//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define("__archetypo/build-sub",["require","exports","module","lodash","jquery","q"],function(e,r,t){var a=e("lodash"),n=e("jquery"),o=e("q");t.exports=function(e,r){var t=e.find("[data-"+r.viewPrefix+"]"),i=a.map(t,function(e){return n(e).archetypo(r)},this);return o.all(i)}}),define("__archetypo/load",["require","exports","module","lodash","q"],function(e,r,t){function a(e){n.each(e,function(e,r){if(!e)throw new Error("Module '"+r+"' does not have a valid path.")})}var n=e("lodash"),o=e("q");t.exports=function(r){a(r);var t=o.defer(),i=n.keys(r),u=n.values(r);return e(u,function(){t.resolve(n.zipObject(i,arguments))}),t.promise}}),define("__archetypo/parse-prefixed-data",["require","exports","module","lodash"],function(e,r,t){var a=e("lodash");t.exports=function(e,r){var t=new RegExp("^"+r),n=e.data(),o={};return a.each(n,function(e,a){if(e&&t.test(a)){var n=a.replace(r,"");n=n.charAt(0).toLowerCase()+n.slice(1),n=n?n:"main",o[n]=e}}),o}}),define("__archetypo/build-el",["require","exports","module","lodash","jquery","q","./build-sub","./load","./parse-prefixed-data"],function(e,r,t){var a=e("lodash"),n=(e("jquery"),e("q")),o=e("./build-sub"),i=e("./load"),u=e("./parse-prefixed-data");t.exports=function(e,r){var t=e.data("_arch-promise");if(!t){e.data(r.storage,{});var d=u(e,r.modulePrefix),s=u(e,r.viewPrefix),l=[i(s),i(d)];t=n.spread(l,function(t,o){r=a.extend({},r,o);var i=a.extend({el:e},r),u=a.map(t,function(t,a){return n.when(t(i)).then(function(t){e.data(r.storage)[a]=t})});return n.all(u)}).then(function(){return o(e,r)}).then(function(){return e}),e.data("_arch-promise",t),t.done()}return t}}),define("archetypo",["require","exports","module","lodash","jquery","./__archetypo/build-el"],function(e){function r(e,r){return r=r||"main",e.data(u)[r]}function t(e,r){return r=r||{},a.defaults(r,i),u=r.storage=r.storage||u,o(e,r)}var a=e("lodash"),n=e("jquery"),o=e("./__archetypo/build-el"),i={modulePrefix:"module",viewPrefix:"archetypo"},u="_arch-views";n.prototype.archetypo=function(){var e=this.data("__archetypo-initialized");return e&&(0===arguments.length||a.isString(arguments[0]))?r(this,arguments[0]):(this.data("__archetypo-initialized",!0),t(this,arguments[0]))}});