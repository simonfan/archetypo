//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define("__archetypo/build/sub",["require","exports","module","q","_q","jquery"],function(e,r,t){var o=e("q"),a=e("_q"),n=e("jquery");t.exports=function(){var e=o.defer(),r=this.el.find(this.archSelector);return a.map(r,function(e){e=n(e);var r=e.data("archetypo");if(r)return r.promise;var t=this.create({el:e});return t.promise},this).done(function(){e.resolve()}),e.promise}}),define("__archetypo/parse/value",["require","exports","module"],function(e,r,t){function o(e){return"["+e+"]"}function a(e){var r={};return e?e[2]?(r.type="invocation",r.priority=""===e[1]?"0":e[1],r.method=e[2],r.value=o(e[3])):e[4]&&(r.type="value",r.value=e[4]):r.type="empty",r}var n="\\s*",i="(?:(\\d*)!)?",s="([\\w$\\-]*)",u=":"+n+"(.*)"+n,h=["^",n,"(?:",i,n,s,n,u,"|","(.*?)",")",n,"$"].join(""),c=new RegExp(h);t.exports=function(e){var r=e.match(c);return a(r)}}),define("__archetypo/methods/data",["require","exports","module","lodash","jquery-meta-data","../parse/value"],function(e,r){var t=e("lodash"),o=(e("jquery-meta-data"),e("../parse/value"));r.archData=function(){var e=t.toArray(arguments),r=e.shift()||{};return t.defaults(r,this.archDataOptions),e.unshift(r),this.el.metaData.apply(this.el,e)},r.archDataOptions={prefix:"arch",parse:o,replace:!1}}),define("__archetypo/helpers",["require","exports","module","lodash"],function(e,r){e("lodash");r.camelCase=function(e){return e.replace(/-(.)/g,function(e,r){return r.toUpperCase()})}}),define("__archetypo/methods/arch-evaluate/invoke",["require","exports","module","q","_q","lodash","../../helpers"],function(e,r,t){function o(e){var r=n.defer(),t=u.camelCase(e.method),o=this.invoke(t,e.value);return n.isPromise(o)?o.done(r.resolve):r.resolve(o),r.promise}function a(e){var r=n.defer();return i.mapValues(e,o,this).done(s.bind(function(e){this.assign(e),r.resolve()},this)),r.promise}var n=e("q"),i=e("_q"),s=e("lodash"),u=e("../../helpers");t.exports=function(e){var r=n.defer(),t=s.unique(s.pluck(e,"priority")).sort(function(e,r){return e-r}),o=s.map(t,function(r){return s.pick(e,function(e){return e.priority===r})});return i.each(o,a,this).done(function(){r.resolve()}),r.promise}}),define("__archetypo/methods/arch-evaluate/index",["require","exports","module","lodash","q","./invoke"],function(e,r){var t=e("lodash"),o=e("q"),a=e("./invoke");r.archEvaluate=function(e){var r=o.defer(),n=t.reduce(e,function(e,r,t){return"value"===r.type&&(e[t]=this.evaluate(r.value)),e},{},this);this.assign(n);var i=t.pick(e,function(e){return"invocation"===e.type}),s=this;return a.call(this,i).done(function(){r.resolve(s)}),r.promise}}),define("__archetypo/methods/index",["require","exports","module","lodash","q","deep","scope"],function(e,r){var t=e("lodash"),o=e("q"),a=e("deep");r.load=function(r,t){var n=o.defer();return t?e([r],function(e){n.resolve(a.get(e,t))}):e([r],n.resolve),n.promise},r.summon=function(e){var r=Array.prototype.slice.call(arguments,1);return r=r&&r.length>0?r:[this],this.load(e).then(t.bind(function(e){e.apply(this,r)},this))},r.l=r.load,r.s=r.summon;var n=e("scope");r.create=function(e){var r=n.prototype.create.call(this,e);return r.archInit(),r}}),define("archetypo",["require","exports","module","lodash","jquery","scope","q","./__archetypo/build/sub","./__archetypo/methods/data","./__archetypo/methods/arch-evaluate/index","./__archetypo/methods/index"],function(e,r,t){var o=e("lodash"),a=(e("jquery"),e("scope")),n=e("q"),i=e("./__archetypo/build/sub"),s={enumerable:!1},u=t.exports=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments),this.archInit()},archInit:function(){this.el.data("archetypo",this);var e=this.el;if(!e||0===e.length)throw new Error("No el on for archetypo constructor.");var r=n.defer();this.promise=r.promise,this.done=o.bind(r.promise.done,r.promise);var t=this.archData();this.archEvaluate(t).then(o.bind(i,this)).done(o.partial(r.resolve,this))},archSelector:"[data-archetypo]"},s);u.assignProto(e("./__archetypo/methods/data"),s),u.assignProto(e("./__archetypo/methods/arch-evaluate/index"),s),u.assignProto(e("./__archetypo/methods/index"),s)});