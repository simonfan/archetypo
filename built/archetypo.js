//     Archetypo
//     (c) simonfan
//     Archetypo is licensed under the MIT terms.

!function(e){function t(){this._events={},this._conf&&i.call(this,this._conf)}function i(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function s(e){this._events={},this.newListener=!1,i.call(this,e)}function n(e,t,i,s){if(!i)return[];var r,o,l,h,a,c,f,u=[],p=t.length,d=t[s],_=t[s+1];if(s===p&&i._listeners){if("function"==typeof i._listeners)return e&&e.push(i._listeners),[i];for(r=0,o=i._listeners.length;o>r;r++)e&&e.push(i._listeners[r]);return[i]}if("*"===d||"**"===d||i[d]){if("*"===d){for(l in i)"_listeners"!==l&&i.hasOwnProperty(l)&&(u=u.concat(n(e,t,i[l],s+1)));return u}if("**"===d){f=s+1===p||s+2===p&&"*"===_,f&&i._listeners&&(u=u.concat(n(e,t,i,p)));for(l in i)"_listeners"!==l&&i.hasOwnProperty(l)&&("*"===l||"**"===l?(i[l]._listeners&&!f&&(u=u.concat(n(e,t,i[l],p))),u=u.concat(n(e,t,i[l],s))):u=l===_?u.concat(n(e,t,i[l],s+2)):u.concat(n(e,t,i[l],s)));return u}u=u.concat(n(e,t,i[d],s+1))}if(h=i["*"],h&&n(e,t,h,s+1),a=i["**"])if(p>s){a._listeners&&n(e,t,a,p);for(l in a)"_listeners"!==l&&a.hasOwnProperty(l)&&(l===_?n(e,t,a[l],s+2):l===d?n(e,t,a[l],s+1):(c={},c[l]=a[l],n(e,t,{"**":c},s+1)))}else a._listeners?n(e,t,a,p):a["*"]&&a["*"]._listeners&&n(e,t,a["*"],p);return u}function r(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var i=0,s=e.length;s>i+1;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var n=this.listenerTree,r=e.shift();r;){if(n[r]||(n[r]={}),n=n[r],0===e.length){if(n._listeners){if("function"==typeof n._listeners)n._listeners=[n._listeners,t];else if(o(n._listeners)&&(n._listeners.push(t),!n._listeners.warned)){var h=l;"undefined"!=typeof this._events.maxListeners&&(h=this._events.maxListeners),h>0&&n._listeners.length>h&&(n._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",n._listeners.length),console.trace())}}else n._listeners=t;return!0}r=e.shift()}return!0}var o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=10;s.prototype.delimiter=".",s.prototype.setMaxListeners=function(e){this._events||t.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},s.prototype.event="",s.prototype.once=function(e,t){return this.many(e,1,t),this},s.prototype.many=function(e,t,i){function s(){0===--t&&n.off(e,s),i.apply(this,arguments)}var n=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");return s._origin=i,this.on(e,s),n},s.prototype.emit=function(){this._events||t.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var i=arguments.length,s=new Array(i-1),r=1;i>r;r++)s[r-1]=arguments[r];for(r=0,i=this._all.length;i>r;r++)this.event=e,this._all[r].apply(this,s)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var l="string"==typeof e?e.split(this.delimiter):e.slice();n.call(this,o,l,this.listenerTree,0)}else o=this._events[e];if("function"==typeof o){if(this.event=e,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var i=arguments.length,s=new Array(i-1),r=1;i>r;r++)s[r-1]=arguments[r];o.apply(this,s)}return!0}if(o){for(var i=arguments.length,s=new Array(i-1),r=1;i>r;r++)s[r-1]=arguments[r];for(var h=o.slice(),r=0,i=h.length;i>r;r++)this.event=e,h[r].apply(this,s);return h.length>0||this._all}return this._all},s.prototype.on=function(e,i){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof i)throw new Error("on only accepts instances of Function");if(this._events||t.call(this),this.emit("newListener",e,i),this.wildcard)return r.call(this,e,i),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],i];else if(o(this._events[e])&&(this._events[e].push(i),!this._events[e].warned)){var s=l;"undefined"!=typeof this._events.maxListeners&&(s=this._events.maxListeners),s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=i;return this},s.prototype.onAny=function(e){if(this._all||(this._all=[]),"function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},s.prototype.addListener=s.prototype.on,s.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var i,s=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();s=n.call(this,null,r,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],s.push({_listeners:i})}for(var l=0;l<s.length;l++){var h=s[l];if(i=h._listeners,o(i)){for(var a=-1,c=0,f=i.length;f>c;c++)if(i[c]===t||i[c].listener&&i[c].listener===t||i[c]._origin&&i[c]._origin===t){a=c;break}if(0>a)continue;return this.wildcard?h._listeners.splice(a,1):this._events[e].splice(a,1),0===i.length&&(this.wildcard?delete h._listeners:delete this._events[e]),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete h._listeners:delete this._events[e])}return this},s.prototype.offAny=function(e){var t,i=0,s=0;if(e&&this._all&&this._all.length>0){for(t=this._all,i=0,s=t.length;s>i;i++)if(e===t[i])return t.splice(i,1),this}else this._all=[];return this},s.prototype.removeListener=s.prototype.off,s.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||t.call(this),this;if(this.wildcard)for(var i="string"==typeof e?e.split(this.delimiter):e.slice(),s=n.call(this,null,i,this.listenerTree,0),r=0;r<s.length;r++){var o=s[r];o._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},s.prototype.listeners=function(e){if(this.wildcard){var i=[],s="string"==typeof e?e.split(this.delimiter):e.slice();return n.call(this,i,s,this.listenerTree,0),i}return this._events||t.call(this),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},s.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define("eventemitter2",[],function(){return s}):e.EventEmitter2=s}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof exports?exports:window),define("__archetypo/eventemitter/index",["require","exports","module","lodash","subject","eventemitter2"],function(e,t,i){var s=(e("lodash"),e("subject")),n=e("eventemitter2");n="function"==typeof n?n:n.EventEmitter2;var r={wildcard:!0,delimiter:".",newListener:!1,maxListeners:0},o=i.exports=s(function(){n.call(this,r)});o.proto(n.prototype)}),define("__archetypo/model/setters",["require","exports","module","lodash","subject"],function(e,t){{var i=e("lodash");e("subject")}t.set=function(e,t,s){i.isString(e)?this.attributes[e]!==t&&(this.attributes[e]=t,this.emit("change",this,e),this.emit("change:"+e,this)):(s=t,i.each(e,i.bind(function(e,t){this.set(t,e,s)},this)))}}),define("__archetypo/view/index",["require","exports","module","lodash","subject"],function(e,t,i){{var s=(e("lodash"),e("subject"));i.exports=s(function(e,t,i){this.$el=e,this.map=t,this.options=i})}}),define("__archetypo/model/view",["require","exports","module","lodash","subject","../view/index"],function(e,t){{var i=(e("lodash"),e("subject"),e("../view/index"));i.extend(function(){i.prototype.initialize.apply(this,arguments)})}t.view=function(){}}),define("__archetypo/model/index",["require","exports","module","lodash","../eventemitter/index","./setters","./view"],function(e,t,i){var s=(e("lodash"),e("../eventemitter/index")),n=i.exports=s.extend(function(e){s.prototype.initialize.apply(this,arguments),this.attributes=e});n.proto({idAttribute:"id",get:function(e){return this.attributes[e]}}),n.proto(e("./setters")),n.proto(e("./view"))}),define("archetypo",["require","exports","module","lodash","subject","./__archetypo/model/index"],function(e,t,i){var s=(e("lodash"),e("subject"),i.exports=function(){});s.model=e("./__archetypo/model/index")});