//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define("__archetypo/helpers",["require","exports","module","lodash"],function(e,r){e("lodash");r.camelCase=function(e){return e.replace(/-(.)/g,function(e,r){return r.toUpperCase()})}}),define("__archetypo/build/evaluate/invoke",["require","exports","module","q","_q","lodash","../../helpers"],function(e,r,t){function o(e){var r=n.defer(),t=u.camelCase(e.method),o=this.invoke(t,e.value);return n.isPromise(o)?o.done(r.resolve):r.resolve(o),r.promise}function i(e){var r=n.defer();return a.mapValues(e,o,this).done(s.bind(function(e){this.assign(e),r.resolve()},this)),r.promise}var n=e("q"),a=e("_q"),s=e("lodash"),u=e("../../helpers");t.exports=function(e){var r=n.defer(),t=s.unique(s.pluck(e,"priority")).sort(function(e,r){return e-r}),o=s.map(t,function(r){return s.pick(e,function(e){return e.priority===r})});return a.each(o,i,this).done(function(){r.resolve()}),r.promise}}),define("__archetypo/build/evaluate/index",["require","exports","module","lodash","q","./invoke"],function(e,r,t){var o=e("lodash"),i=e("q"),n=e("./invoke");t.exports=function(){var e=i.defer(),r=this.archData(),t=o.pick(r,function(e){return"literal"===e.type});this.assign(t);var a=o.pick(r,function(e){return"invocation"===e.type});return n.call(this,a).done(function(){e.resolve()}),e.promise}}),define("__archetypo/build/sub/index",["require","exports","module","q","_q","jquery"],function(e,r,t){var o=e("q"),i=e("_q"),n=e("jquery");t.exports=function(){var e=o.defer(),r=this.el.find(this.archSelector);return i.map(r,function(e){e=n(e);var r=e.data("archetypo");if(r)return r.promise;var t=this.create({el:e});return t.promise},this).done(function(){e.resolve()}),e.promise}}),define("__archetypo/methods/create",["require","exports","module","scope"],function(e,r){var t=e("scope");r.create=function(e){var r=t.prototype.create.call(this,e);return r.archInit(),r}}),define("__archetypo/methods/require",["require","exports","module","lodash","q"],function(e,r){var t=e("lodash"),o=e("q");r.require=function(r){var t=o.defer();return e([r],t.resolve),t.promise},r.requireAndPartialize=function(e,r){return this.require(e).then(t.bind(function(e){return this.partial(e,r)},this))},r.requireAndInvoke=function(e,r){return this.require(e).then(t.bind(function(e){return this.invoke(e,[],r)},this))}}),define("__archetypo/parse/value",["require","exports","module"],function(e,r,t){function o(e){return"["+e+"]"}function i(e){var r={};return e?e[2]?(r.type="invocation",r.priority=""===e[1]?"0":e[1],r.method=e[2],r.value=o(e[3])):e[4]&&(r.type="literal",r.value=e[4]):r.type="empty",r}var n="\\s*",a="(?:(\\d*)!)?",s="([\\w$\\-]*)",u="\\("+n+"(.*)"+n+"\\)",h=[n,"(?:",a,n,s,n,u,"|",s,")"+n].join(""),c=new RegExp(h);t.exports=function(e){var r=e.match(c);return i(r)}}),define("__archetypo/methods/data",["require","exports","module","lodash","jquery-meta-data","../parse/value"],function(e,r){var t=e("lodash"),o=(e("jquery-meta-data"),e("../parse/value"));r.archData=function(){var e=t.toArray(arguments),r=e.shift()||{};return t.defaults(r,this.archDataOptions),e.unshift(r),this.el.metaData.apply(this.el,e)},r.archDataOptions={prefix:"arch",parse:o,replace:!1}}),define("__archetypo/methods/eval",["require","exports","module"],function(e,r){var t={};t.json=JSON.parse,r.eval=function(e){return console.log(e),this.evaluate(e)},r.json=JSON.parse}),define("archetypo",["require","exports","module","lodash","jquery","scope","q","./__archetypo/build/evaluate/index","./__archetypo/build/sub/index","./__archetypo/methods/create","./__archetypo/methods/require","./__archetypo/methods/data","./__archetypo/methods/eval"],function(e,r,t){var o=e("lodash"),i=(e("jquery"),e("scope")),n=e("q"),a=e("./__archetypo/build/evaluate/index"),s=e("./__archetypo/build/sub/index"),u={enumerable:!1},h=t.exports=i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this.archInit()},archInit:function(){this.el.data("archetypo",this);var e=this.el;if(!e)throw new Error("No el on archetypo.");var r=n.defer();this.promise=r.promise,this.done=o.bind(r.promise.done,r.promise),a.call(this).then(o.bind(s,this)).done(o.partial(r.resolve,this))},archSelector:"[data-archetypo]"},u);h.assignProto(e("./__archetypo/methods/create"),u),h.assignProto(e("./__archetypo/methods/require"),u),h.assignProto(e("./__archetypo/methods/data"),u),h.assignProto(e("./__archetypo/methods/eval"),u)});