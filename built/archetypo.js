//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define("__archetypo/build-sub",["require","exports","module","lodash","jquery","q"],function(e,r,t){var n=e("lodash"),u=e("jquery"),o=e("q");t.exports=function(e,r){var t=e.find("[data-builder]"),a=n.map(t,function(e){u(e).archetypo(r)},this);return o.all(a)}}),define("__archetypo/load",["require","exports","module","lodash","q"],function(e,r){function t(r,t){var n=o.defer();return t=t||r,e(t,function(){n.resolve(u.zipObject(r,arguments))}),n.promise}function n(e){return u.isString(e)?e.split(a):[]}var u=e("lodash"),o=e("q");r.modules=function(e,r){var n=e.data(),o=[],a=[];return u.each(r,function(e){var r=n[e];u.isString(r)&&(o.push(e),a.push(r))}),t(o,a)};var a=/\s+/;r.builders=function(e){var r=n(e.data("builder"));return t(r)}}),define("__archetypo/build-el",["require","exports","module","lodash","jquery","q","./build-sub","./load"],function(e,r,t){var n=e("lodash"),u=(e("jquery"),e("q")),o=e("./build-sub"),a=e("./load");t.exports=function(e,r){var t=e.data("archetypo-done");if(!t){e.data("archetypo-done",t),e.data("views",{});var i=[a.builders(e),a.modules(e,r.loadable)];return u.spread(i,function(t,o){var a=n.extend({el:e},r,o),i=n.map(t,function(r,t){return u.when(r(a)).then(function(r){e.data("views")[t]=r})});return u.all(i)}).then(function(){return o(e,r)}).then(function(){return e})}return t}}),define("archetypo",["require","exports","module","lodash","jquery","./__archetypo/build-el"],function(e){var r=e("lodash"),t=e("jquery"),n=e("./__archetypo/build-el");t.prototype.archetypo=function(e){return n(this,e)},t.prototype.view=function(e){return this.data("views")[e]},t.prototype.subviews=function(e,n){var u=this.find(e);return r(u).map(function(e){return t(e).view(n)})}});