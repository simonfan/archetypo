//     archetypo
//     (c) simonfan
//     archetypo is licensed under the MIT terms.

define(["require","exports","module","subject","lowercase-backbone","dockable-view","q","lodash","./__archetypo/view/index","./__archetypo/router/index","./__archetypo/view/initialize/register","./__archetypo/view/initialize/subviews"],function(e,t,n){var r=e("subject"),i=e("lowercase-backbone"),s=e("dockable-view"),o=e("q"),u=e("lodash"),a=e("./__archetypo/view/index"),f=e("./__archetypo/router/index"),l=e("./__archetypo/view/initialize/register"),c=e("./__archetypo/view/initialize/subviews"),h=n.exports=a.extend(i.router.prototype).extend(f.prototype);h.proto({initialize:function(t){f.prototype.initialize.apply(this,arguments),this.isApp=!0,this.constructors={view:{"default":a},model:{},collection:{}},this.instances={view:{},model:{},collection:{}}},constructor:function(t,n,r){var i=this.constructors[t],s=i[n]||i["default"];if(arguments.length===3)return i[n]=s.extend(r),i[n];if(arguments.length===2)return u.isObject(n)&&u.each(n,u.bind(this,function(e,n){this.constructor(t,n,e)})),s},instance:function(t,n,r){var i=this.instances[t]=this.instances[t]||{};return arguments.length===3&&(i[n]=r),i[n]},build:function(t){s.prototype.initialize.apply(this,arguments);if(!this.$el)throw new Error("No DOM element in archetypo.");l.apply(this,arguments),c.apply(this)},start:function(t){return this.build(t),i.history.start(t),this}}),h.proto({view:u.partial(h.prototype.instance,"view"),model:u.partial(h.prototype.instance,"model"),collection:u.partial(h.prototype.instance,"collection")})});